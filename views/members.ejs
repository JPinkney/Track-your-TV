<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>

    <script src="/javascripts/jquery.js"</script>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel='stylesheet' href='/stylesheets/members.css' />
    
    <script type="text/javascript" src="/javascripts/main.js"></script>
  </head>
  <body>

  		<% if (user) { %>

			<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
			<div id="flipkart-navbar">
			    <div class="container">
			        <div class="row row1">
			            <ul class="largenav pull-right">
			                <li class="upper-links"><a class="links" href="/profile"><%= user.username %></a></li>
			                <li class="upper-links"><a class="links" href="/logout">Logout</a></li>
			            </ul>
			        </div>
			        <div class="row row2">
			            <div class="col-sm-2">
			                <h2 style="margin:0px;"><span class="smallnav menu" onclick="openNav()">☰ Track</span></h2>
			            </div>
			            <div class="flipkart-navbar-search smallsearch col-sm-8 col-xs-11">
			                <div class="row">
			                    <input class="flipkart-navbar-input col-xs-11" type="" placeholder="Search for a show" name="" id="search-input">
			                    <button class="flipkart-navbar-button col-xs-1" id="search-button">
			                        <svg width="15px" height="15px">
			                            <path d="M11.618 9.897l4.224 4.212c.092.09.1.23.02.312l-1.464 1.46c-.08.08-.222.072-.314-.02L9.868 11.66M6.486 10.9c-2.42 0-4.38-1.955-4.38-4.367 0-2.413 1.96-4.37 4.38-4.37s4.38 1.957 4.38 4.37c0 2.412-1.96 4.368-4.38 4.368m0-10.834C2.904.066 0 2.96 0 6.533 0 10.105 2.904 13 6.486 13s6.487-2.895 6.487-6.467c0-3.572-2.905-6.467-6.487-6.467 "></path>
			                        </svg>
			                    </button>
			                </div>
			            </div>
			        </div>
			    </div>
			</div>

			<div id="middle-container">
				<% for(var i=0; i < shows.length; i++) {%>
	  				<div class="show-container">
					  <img src=<%= shows[i].image %> alt="Avatar" class="image">
					  <div class="middle">
					    <input id=<%= shows[i].id %> class="text" value="Remove Show" type="submit">
					  </div>
					</div>
				<% } %>
			</div>

			<div id="mySidenav" class="sidenav">
			    <div class="container" style="background-color: #2874f0; padding-top: 10px;">
			        <span class="sidenav-heading">Home</span>
			        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
			    </div>
			    <a href="/logout">Logout</a>
			</div>

		<% } else { %>

			<script type="text/javascript">
				window.location.replace("/");	
			</script>

		<% } %>

		<script type="text/javascript">

			for(let x = 0; x < $('.show-container').length; x++){
				$('#'+$('.show-container > .middle > .text')[x].id).on('click', function(){
					$.post('/api/shows/removeFromUserViaID', {"showid": $('#'+$('.show-container > .middle > .text')[x].id)[0].id}, function(resp){
						$('#'+$('.show-container > .middle > .text')[x].id).parent().parent().remove();
					});
				});
			}

			$('#search-button').on('click', function(){
				//Do the request to the backend
				var showToAdd = $('#search-input').val();

				$.post('/api/shows/addShowToUser', {'showname': showToAdd}, function(result){

					alert(result.id);

					if(result.message){
						alert(result.message);
					}else{
						$('#middle-container').append('<div class="show-container"><img src=' + result.imagesrc + ' alt="Avatar" class="image"><div class="middle"><div id=' + result.id + ' class="text">Remove Show</div></div>');
						$('#search-input').val('');

						$('#'+result.id).on('click', function(){
							$.post('/api/shows/removeFromUserViaID', {"showid": result.id}, function(resp){
								$('#'+result.id).parent().parent().remove();
							});
						});
					}

				});
			});

		</script>
	    
  </body>
</html>
